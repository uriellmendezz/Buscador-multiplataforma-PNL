import requests
import json
from env import COOKIES_FRAVEGA

headers = {
    'accept': '*/*',
    'accept-language': 'es-419,es;q=0.6',
    'content-type': 'application/json',
    'origin': 'https://www.fravega.com',
    'priority': 'u=1, i',
    'referer': 'https://www.fravega.com/l/informatica/notebooks/',
    'sec-ch-ua': '"Brave";v="141", "Not?A_Brand";v="8", "Chromium";v="141"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'sec-gpc': '1',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36',
    # 'cookie': 'AWSALB=eY51wM4CQI4p/3nwrhKPKOnXZk83wNwMgv0ksKnIXKWCl5+WvgaMQmiQX2mKgNifp7rCwhV6ObPoWCHABJtq5R3P7Ej+X0xKIZQ9tD/862p636ThmK7IN+X0zvf0',
}

json_data = {
    'operationName': 'listProducts_Shopping',
    'variables': {
        'customSorted': False,
        'isGeoLocated': True,
        'isSingleCategory': True,
        'filtering': {
            'categories': [
                'informatica/notebooks',
            ],
            'availableStock': {
                'postalCodes': 'C1406',
                'includeThoseWithNoAvailableStockButListable': True,
            },
            'salesChannels': [
                'fravega-ecommerce',
            ],
            'active': True,
        },
        'size': 1000,
        'offset': 0,
        'sorting': 'TOTAL_SALES_IN_LAST_30_DAYS',
    },
    'query': 'query listProducts_Shopping($size: PositiveInt!, $isSingleCategory: Boolean!, $offset: Int, $sorting: [SortOption!], $customSorted: Boolean = false, $filtering: ItemFilteringInputType, $isGeoLocated: Boolean = false) {\n  items(filtering: $filtering) {\n    total\n    recommendations {\n      keywords: products\n      __typename\n    }\n    results(\n      size: $size\n      buckets: [{sorting: $sorting, customSorted: $customSorted, offset: $offset}]\n    ) {\n      ...extendedItemFragment\n      __typename\n    }\n    aggregations {\n      availableStock @include(if: $isGeoLocated) {\n        ...availabilityStockAggregation\n        __typename\n      }\n      sellerCondition(size: $size) {\n        cardinality\n        values {\n          count\n          filtered\n          condition\n          __typename\n        }\n        __typename\n      }\n      collections(aggregable: true) {\n        values {\n          ...collectionAggregationFragment\n          __typename\n        }\n        __typename\n      }\n      installments {\n        values {\n          ...collectionAggregationFragment\n          __typename\n        }\n        __typename\n      }\n      categories(market: "fravega", flattened: $isSingleCategory) {\n        ...categoryAggregationFragment\n        children {\n          ...categoryAggregationFragment\n          __typename\n        }\n        __typename\n      }\n      attributes {\n        ...attributeAggregationFragment\n        __typename\n      }\n      salePrice {\n        ...rangedSalePriceAggregationFragment\n        __typename\n      }\n      brands {\n        cardinality\n        values(size: 6, sorting: FREQUENCY) {\n          ...brandAggregationFragment\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    listUniqueId\n    __typename\n  }\n}\n\nfragment extendedItemFragment on ExtendedItem {\n  sellers {\n    commercialName\n    __typename\n  }\n  stockLabels\n  id\n  title\n  katalogCategoryId\n  brand {\n    id\n    name\n    __typename\n  }\n  skus {\n    results {\n      code\n      categorization(market: "fravega") {\n        name\n        slug\n        __typename\n      }\n      resolvedBidId\n      sponsored\n      campaignId\n      pricing(channel: "fravega-ecommerce") {\n        channel\n        listPrice\n        salePrice\n        discount\n        __typename\n      }\n      netPricing: pricing(channel: "net-price") {\n        channel\n        listPrice\n        salePrice\n        discount\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  gtin {\n    __typename\n    ... on EAN {\n      number\n      __typename\n    }\n  }\n  id\n  images\n  collections(onlyThoseWithCockade: true) {\n    cardinality\n    values {\n      id\n      name\n      slug\n      count\n      cockade(tag: "listing") {\n        position\n        image\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  installments {\n    cardinality\n    values {\n      id\n      name\n      slug\n      count\n      cockade(tag: "listing") {\n        position\n        image\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  listPrice {\n    amounts {\n      min\n      max\n      __typename\n    }\n    __typename\n  }\n  salePrice {\n    amounts {\n      min\n      max\n      __typename\n    }\n    discounts {\n      min\n      max\n      __typename\n    }\n    __typename\n  }\n  slug\n  __typename\n}\n\nfragment availabilityStockAggregation on AvailabilityStockAggregation {\n  deliveryTerms {\n    value\n    count\n    __typename\n  }\n  types {\n    value\n    count\n    __typename\n  }\n  costs {\n    value\n    count\n    __typename\n  }\n  __typename\n}\n\nfragment collectionAggregationFragment on CollectionAggregation {\n  id\n  name\n  count\n  slug\n  filtered\n  __typename\n}\n\nfragment categoryAggregationFragment on CategoryAggregation {\n  name\n  slug\n  count\n  path {\n    id\n    name\n    slug\n    __typename\n  }\n  children {\n    name\n    slug\n    count\n    path {\n      id\n      name\n      slug\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment attributeAggregationFragment on AttributeAggregation {\n  name\n  slug\n  tags\n  measureUnit {\n    name\n    symbol\n    __typename\n  }\n  values(size: 20) {\n    type\n    value\n    slug\n    count\n    seo\n    filtered\n    __typename\n  }\n  ranges {\n    from\n    to\n    count\n    value\n    slug\n    seo\n    filtered {\n      from\n      to\n      value\n      slug\n      seo\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment rangedSalePriceAggregationFragment on RangedSalePriceAggregation {\n  amounts {\n    ranges(size: 3) {\n      from\n      to\n      count\n      value\n      slug\n      __typename\n    }\n    min\n    max\n    __typename\n  }\n  discounts {\n    ranges(interval: 10) {\n      from\n      count\n      value\n      slug\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment brandAggregationFragment on BrandAggregation {\n  name\n  count\n  slug\n  image\n  filtered\n  __typename\n}\n',
}

response = requests.post('https://www.fravega.com/api/v1', cookies=cookies, headers=headers, json=json_data)
if response.status_code == 200:
    data = response.json()
    with open('datos/notebooks-fravega.json', 'w', encoding='UTF-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
else:
    print(response.status_code)

# Note: json_data will not be serialized by requests
# exactly as it was in the original request.
#data = '{"operationName":"listProducts_Shopping","variables":{"customSorted":false,"isGeoLocated":true,"isSingleCategory":true,"filtering":{"categories":["informatica/notebooks"],"availableStock":{"postalCodes":"C1406","includeThoseWithNoAvailableStockButListable":true},"salesChannels":["fravega-ecommerce"],"active":true},"size":15,"offset":0,"sorting":"TOTAL_SALES_IN_LAST_30_DAYS"},"query":"query listProducts_Shopping($size: PositiveInt!, $isSingleCategory: Boolean!, $offset: Int, $sorting: [SortOption!], $customSorted: Boolean = false, $filtering: ItemFilteringInputType, $isGeoLocated: Boolean = false) {\\n  items(filtering: $filtering) {\\n    total\\n    recommendations {\\n      keywords: products\\n      __typename\\n    }\\n    results(\\n      size: $size\\n      buckets: [{sorting: $sorting, customSorted: $customSorted, offset: $offset}]\\n    ) {\\n      ...extendedItemFragment\\n      __typename\\n    }\\n    aggregations {\\n      availableStock @include(if: $isGeoLocated) {\\n        ...availabilityStockAggregation\\n        __typename\\n      }\\n      sellerCondition(size: $size) {\\n        cardinality\\n        values {\\n          count\\n          filtered\\n          condition\\n          __typename\\n        }\\n        __typename\\n      }\\n      collections(aggregable: true) {\\n        values {\\n          ...collectionAggregationFragment\\n          __typename\\n        }\\n        __typename\\n      }\\n      installments {\\n        values {\\n          ...collectionAggregationFragment\\n          __typename\\n        }\\n        __typename\\n      }\\n      categories(market: \\"fravega\\", flattened: $isSingleCategory) {\\n        ...categoryAggregationFragment\\n        children {\\n          ...categoryAggregationFragment\\n          __typename\\n        }\\n        __typename\\n      }\\n      attributes {\\n        ...attributeAggregationFragment\\n        __typename\\n      }\\n      salePrice {\\n        ...rangedSalePriceAggregationFragment\\n        __typename\\n      }\\n      brands {\\n        cardinality\\n        values(size: 6, sorting: FREQUENCY) {\\n          ...brandAggregationFragment\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    listUniqueId\\n    __typename\\n  }\\n}\\n\\nfragment extendedItemFragment on ExtendedItem {\\n  sellers {\\n    commercialName\\n    __typename\\n  }\\n  stockLabels\\n  id\\n  title\\n  katalogCategoryId\\n  brand {\\n    id\\n    name\\n    __typename\\n  }\\n  skus {\\n    results {\\n      code\\n      categorization(market: \\"fravega\\") {\\n        name\\n        slug\\n        __typename\\n      }\\n      resolvedBidId\\n      sponsored\\n      campaignId\\n      pricing(channel: \\"fravega-ecommerce\\") {\\n        channel\\n        listPrice\\n        salePrice\\n        discount\\n        __typename\\n      }\\n      netPricing: pricing(channel: \\"net-price\\") {\\n        channel\\n        listPrice\\n        salePrice\\n        discount\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  gtin {\\n    __typename\\n    ... on EAN {\\n      number\\n      __typename\\n    }\\n  }\\n  id\\n  images\\n  collections(onlyThoseWithCockade: true) {\\n    cardinality\\n    values {\\n      id\\n      name\\n      slug\\n      count\\n      cockade(tag: \\"listing\\") {\\n        position\\n        image\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  installments {\\n    cardinality\\n    values {\\n      id\\n      name\\n      slug\\n      count\\n      cockade(tag: \\"listing\\") {\\n        position\\n        image\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  listPrice {\\n    amounts {\\n      min\\n      max\\n      __typename\\n    }\\n    __typename\\n  }\\n  salePrice {\\n    amounts {\\n      min\\n      max\\n      __typename\\n    }\\n    discounts {\\n      min\\n      max\\n      __typename\\n    }\\n    __typename\\n  }\\n  slug\\n  __typename\\n}\\n\\nfragment availabilityStockAggregation on AvailabilityStockAggregation {\\n  deliveryTerms {\\n    value\\n    count\\n    __typename\\n  }\\n  types {\\n    value\\n    count\\n    __typename\\n  }\\n  costs {\\n    value\\n    count\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment collectionAggregationFragment on CollectionAggregation {\\n  id\\n  name\\n  count\\n  slug\\n  filtered\\n  __typename\\n}\\n\\nfragment categoryAggregationFragment on CategoryAggregation {\\n  name\\n  slug\\n  count\\n  path {\\n    id\\n    name\\n    slug\\n    __typename\\n  }\\n  children {\\n    name\\n    slug\\n    count\\n    path {\\n      id\\n      name\\n      slug\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment attributeAggregationFragment on AttributeAggregation {\\n  name\\n  slug\\n  tags\\n  measureUnit {\\n    name\\n    symbol\\n    __typename\\n  }\\n  values(size: 20) {\\n    type\\n    value\\n    slug\\n    count\\n    seo\\n    filtered\\n    __typename\\n  }\\n  ranges {\\n    from\\n    to\\n    count\\n    value\\n    slug\\n    seo\\n    filtered {\\n      from\\n      to\\n      value\\n      slug\\n      seo\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment rangedSalePriceAggregationFragment on RangedSalePriceAggregation {\\n  amounts {\\n    ranges(size: 3) {\\n      from\\n      to\\n      count\\n      value\\n      slug\\n      __typename\\n    }\\n    min\\n    max\\n    __typename\\n  }\\n  discounts {\\n    ranges(interval: 10) {\\n      from\\n      count\\n      value\\n      slug\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment brandAggregationFragment on BrandAggregation {\\n  name\\n  count\\n  slug\\n  image\\n  filtered\\n  __typename\\n}\\n"}'
#response = requests.post('https://www.fravega.com/api/v1', cookies=cookies, headers=headers, data=data)